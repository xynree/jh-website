---
import upcomingShows from "../content/upcoming.json";
---

<h3>shows</h3>

<ul class="list">
  {
    upcomingShows.map((show) => (
      <li>
        <span>{show.venue}</span>
        <span class="fill" />
        <span>{show.date}</span>
      </li>
    ))
  }
</ul>
<script type="module">
  function fillAreasWithChars(fillChar = ".") {
    const listItems = document.querySelectorAll(".list li");

    listItems.forEach((item) => {
      const fillDiv = item.querySelector(".fill");
      if (!fillDiv) return;

      // Get all text nodes and elements in the list item
      const childNodes = Array.from(item.childNodes);

      // Find the fill div's position
      const fillIndex = childNodes.indexOf(fillDiv);

      // Get text before fill div
      const textBefore = childNodes
        .slice(0, fillIndex)
        .map((node) => node.textContent || "")
        .join("")
        .trim();

      // Get text after fill div
      const textAfter = childNodes
        .slice(fillIndex + 1)
        .map((node) => node.textContent || "")
        .join("")
        .trim();

      // Calculate approximate character count needed
      // Assuming monospace font, we can estimate based on text length
      // You may need to adjust the multiplier based on your font size and container width
      const container =
        item.closest("main") ||
        item.closest(".list") ||
        document.querySelector("main");

      console.log(container.offsetWidth);
      const containerWidth = container ? container.offsetWidth - 24 : 650; // fallback to 650px if container not found
      const charWidth = 8; // approximate monospace character width in pixels at font-size 14px

      const textBeforeWidth = textBefore.length * charWidth;
      const textAfterWidth = textAfter.length * charWidth;

      const remainingWidth = containerWidth - textBeforeWidth - textAfterWidth;
      const charsNeeded = Math.max(0, Math.floor(remainingWidth / charWidth));

      // Fill the div with characters
      fillDiv.textContent = fillChar.repeat(charsNeeded) ?? "";
    });
  }

  // Debounce function to limit how often the resize handler fires
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // Call the function when the DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", fillAreasWithChars);
  } else {
    fillAreasWithChars();
  }

  // Add resize event listener with debouncing
  window.addEventListener(
    "resize",
    debounce(() => fillAreasWithChars(), 100)
  );
</script>

<style>
  .list {
    font-family: monospace;
    list-style-type: none;
    font-size: 13px;
  }

  h3 {
    margin: 1rem 0 0.25rem;
  }

  ul {
    padding-left: 0;
    margin: 0;
  }

  li:not(:last-child) {
    margin-bottom: 12px;
  }
</style>
